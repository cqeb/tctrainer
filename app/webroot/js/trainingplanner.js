TrainingPlanner={offset:0,initialized:false,url:"",slider:null,p:null,n:null,sports:null,oldWeek:-1,tri:false,ratioTriathlon:[20,60],ratioDuathlon:[40],init:function(a,b,c,d){var e=this;this.url=a;this.sports=c.split(",");if(this.sports.length==3){this.tri=true}this.advancedFeatures=d;this.initDescriptionToggler();this.initDistributor();$("#avg").val(TimeParser.format(b)+"h");this.slider=$("#slider");if(this.sports.length==2){this.slider.slider({range:false,min:0,max:100,value:0,slide:function(a,b){e.balanceUpdated()},stop:function(){e.saveWorkoutSettings()}})}else if(this.sports.length==3){this.slider.slider({range:true,min:0,max:100,values:[0,0],slide:function(a,b){e.balanceUpdated()},stop:function(){e.saveWorkoutSettings()}})}$("#avg").change(function(){var a=TimeParser.parse(jQuery(this).val());jQuery.post(e.url+"/trainingplans/set_avg",{time:a},function(){document.location.reload()})});$("#week").blur(function(){e.weekUpdated(true)}).keyup(function(a){if(a.keyCode==13){e.weekUpdated(true)}}).focus(function(){TrainingPlanner.oldWeek=TimeParser.parse(this.value);this.select()});this.p=$("#prev");this.n=$("#next");this.p.click(function(){e.prev();e.lock()});this.n.click(function(){e.next();e.lock()});this.getPlan();this.initialized=true},initDescriptionToggler:function(){jQuery("#toggleDesc").click(function(){var a=jQuery("td.description div");a.slideToggle();var b=jQuery(this);var c=b.html();b.html(b.attr("data-toggletext"));b.attr("data-toggletext",c)})},initDistributor:function(){var a=jQuery(".distribution .box");if(this.sports.length==1){a.hide();return}var b="";for(var c=0;c<this.sports.length;c++){if(c==this.sports.length-1){b="last"}a.append('<div class="sporttime br '+b+'">'+"<h3>"+this.sports[c]+' <small id="p'+(c+1)+'">0%</small></h3>'+'<div id="time'+(c+1)+'"></div>'+"</div>")}},next:function(){this.offset++;this.getPlan();if(this.offset==3&&!this.advancedFeatures){this.n.fadeOut()}},prev:function(){this.offset--;this.getPlan();if(this.offset<3){this.n.fadeIn()}},lock:function(){this.p.attr("disabled","disabled");this.n.attr("disabled","disabled")},unlock:function(){this.n.removeAttr("disabled");this.p.removeAttr("disabled")},getPlan:function(){var a=this;if(this.initialized){var b=jQuery("td.description div").is(":visible")}else{var b=true}$("#plan").fadeTo("slow",.4);$("#loader").fadeIn();var c=this.url+"/trainingplans/get?o="+this.offset+"&t="+(new Date).getTime();$.get(c,function(c){$("#plan").html(a.addZoneInfo(c));ZoneGuide.attach();if(!b){jQuery("td.description div").hide()}if(workoutSettings.usertime>0){$("#week").val(TimeParser.format(workoutSettings.usertime)+"h")}else{$("#week").val(TimeParser.format(workoutSettings.time)+"h")}if(a.sports.length==2){a.slider.slider("option","value",workoutSettings.ratio[0])}else if(a.sports.length==3){var d=[workoutSettings.ratio[0],workoutSettings.ratio[0]+workoutSettings.ratio[1]];a.slider.slider("option","values",d)}$("#plan").fadeTo("normal",1);$("#loader").fadeOut();a.weekUpdated(false);a.unlock();a.checkBalance();jQuery("#plan .category, img.lsd, .workouts .type button").tipTip();jQuery(".workouts .type button").click(function(){a.linkWorkout(jQuery(this))})})},linkWorkout:function(a){var b,c;if(c=a.attr("data-trainingid")){b="/"+c}else{b="?sportstype="+a.attr("data-sportstype")+"&workouttype="+a.attr("data-workouttype")+"&duration="+a.attr("data-duration")+"&avghr="+a.attr("data-avghr")}document.location="/trainer/trainingstatistics/edit_training"+b},addZoneInfo:function(a){return a.replace(/(Zone \d)/g,'<span class="zone">$1</span>')},saveWorkoutSettings:function(){var a=this;if(!this.initialized){return}$("#plan").fadeTo("slow",.4);$("#loader").fadeIn();TimeParser.parse($("#avg").val());var b=TimeParser.mins;TimeParser.parse($("#week").val());var c=TimeParser.mins;var d=$("#slider");var e=0;var f=0;var g=null;if(this.sports.length==3){e=d.slider("values",0);f=d.slider("values",1);g=e+","+(f-e)+","+(100-f)}else if(this.sports.length==2){e=d.slider("value");g=e+","+(100-e)}$.post(this.url+"/trainingplans/save_workout_settings",{time:b,usertime:c,ratio:g,date:workoutSettings.date},function(b){if(b=="ok"){a.getPlan()}else{};})},avgUpdated:function(){var a=$("#avg");TimeParser.parse(a.val());a.val(TimeParser.format()+"h")},weekUpdated:function(a){var b=$("#week");TimeParser.parse(b.val());b.val(TimeParser.format()+"h");if(workoutSettings.time!=TimeParser.mins){$(".avgweekly .reset").fadeIn()}else{$(".avgweekly .reset").fadeOut()}if(TimeParser.mins==this.oldWeek){return}this.balanceUpdated();if(a){this.saveWorkoutSettings()}},balanceUpdated:function(){if(this.sports.length==1){return}var a=this.slider.slider("values",0);if(this.tri){var b=this.slider.slider("values",1)}TimeParser.parse($("#week").val());var c=TimeParser.mins/100;var d=parseInt(a*c);if(this.tri){var e=parseInt((b-a)*c)}else{var e=parseInt((100-a)*c)}$("#time1").text(TimeParser.format(d)+"h");$("#time2").text(TimeParser.format(e)+"h");$("#p1").text(a+"%");if(this.tri){$("#p2").text(b-a+"%")}else{$("#p2").text(100-a+"%")}if(this.tri){var f=parseInt((100-b)*c);$("#time3").text(TimeParser.format(f)+"h");$("#p3").text(100-b+"%")}this.checkBalance()},resetWeeklyHours:function(){$("#week").val(TimeParser.format(workoutSettings.time)+"h");this.weekUpdated(true)},checkBalance:function(){if(this.sports.length==1){return}var a=this.slider.slider("values",0);if(this.tri){var b=this.slider.slider("values",1);if(a!=this.ratioTriathlon[0]||b!=this.ratioTriathlon[1]){jQuery(".distribution .reset").fadeIn()}else{jQuery(".distribution .reset").fadeOut()}}else if(this.sports.length==2){if(a!=this.ratioDuathlon[0]){jQuery(".distribution .reset").fadeIn()}else{jQuery(".distribution .reset").fadeOut()}}},resetWorkoutBalance:function(){if(this.sports.length==1){return}if(this.tri){this.slider.slider("option","values",this.ratioTriathlon)}else{this.slider.slider("option","value",this.ratioDuathlon[0])}this.balanceUpdated();this.saveWorkoutSettings()}}